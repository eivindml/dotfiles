#!/bin/bash

function get_num_untracked {
  expr `git status --porcelain 2>/dev/null| egrep "^(M| M)" | wc -l`
}

function get_dirty_state {
  [[ $(git diff --shortstat 2> /dev/null | tail -n1) != "" ]] && echo "%F{cyan}+$(get_num_untracked)%f"
}

branch=$(git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/ \1/')

if [[ $branch == "fatal:"* ]]; then
  echo ""
else
  if [[ $branch == "" ]]; then
    echo ""
  else
    echo "%F{cyan}‚å•%f$branch$(get_dirty_state)"
  fi
fi
